<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yesterday Once More | 昨日重现</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #333;
            --text-color: #fff;
            --transition-speed: 0.3s;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Space Grotesk', sans-serif;
            height: 100vh;
            overflow: hidden;
            background: var(--bg-color);
            color: var(--text-color);
        }

        .video-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%; /* 覆盖全屏 */
            height: 100%; /* 覆盖全屏 */
            object-fit: cover; /* 保持纵横比例的同时填充全屏 */
            z-index: -2;
            opacity: 1;
            filter: contrast(1.1) brightness(0.9); /* 增强对比度 */
        }

        .glass-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            backdrop-filter: blur(1px);
            -webkit-backdrop-filter: blur(1px);
            background-color: rgba(0, 0, 0, 0.2);
            z-index: -1;
            pointer-events: none;
        }





        .container {
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: center;
            height: 100vh;
            padding: 4rem 2rem;
            position: relative;
            z-index: 1;
            max-width: 1200px;
            margin: 0 auto;
        }

        .logo {
            font-size: 6rem;
            font-weight: 700;
            letter-spacing: -0.05em;
            margin-bottom: 3rem;
            text-align: center;
            width: 100%;
            opacity: 1;
            color: white;
            text-transform: lowercase;
        }

        @keyframes glowPulse {
            0% {
                opacity: 0.3;
                filter: blur(8px);
            }
            100% {
                opacity: 0.7;
                filter: blur(12px);
            }
        }

        .tagline {
            font-size: 1.2rem;
            font-weight: 300;
            margin-bottom: 3rem;
            text-align: center;
            max-width: 600px;
            opacity: 0;
            transform: translateY(20px);
            animation: fadeIn 1s forwards 0.8s;
        }

        .chat-container {
            width: 100%;
            max-width: 800px;
            background-color: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            padding: 2rem;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
            opacity: 1;
            border: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
            overflow: hidden;
        }

        .chat-container::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg,
                        transparent,
                        rgba(255, 255, 255, 0.03),
                        transparent);
            transform: rotate(45deg);
            animation: glassSweep 10s linear infinite;
            pointer-events: none;
        }

        @keyframes glassSweep {
            0% {
                transform: rotate(45deg) translateY(-100%);
            }
            100% {
                transform: rotate(45deg) translateY(100%);
            }
        }

        .chat-messages {
            max-height: 300px;
            overflow-y: auto;
            margin-bottom: 1.5rem;
            padding-right: 0.5rem;
            display: none;
        }

        /* Typing indicator */
        .typing-indicator {
            display: inline-flex;
            align-items: center;
            margin: 0.5rem 0;
        }

        .typing-indicator span {
            height: 8px;
            width: 8px;
            background-color: white;
            border-radius: 50%;
            margin: 0 2px;
            animation: bounce 1.5s infinite ease-in-out;
        }

        .typing-indicator span:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-indicator span:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes bounce {
            0%, 60%, 100% {
                transform: translateY(0);
            }
            30% {
                transform: translateY(-4px);
            }
        }

        .chat-messages::-webkit-scrollbar {
            width: 4px;
        }

        .chat-messages::-webkit-scrollbar-thumb {
            background-color: rgba(255, 255, 255, 0.3);
            border-radius: 2px;
        }

        .message {
            margin-bottom: 1rem;
            padding: 1rem;
            border-radius: 10px;
            animation: ripple 0.5s ease-out;
        }

        .user-message {
            background-color: rgba(255, 255, 255, 0.2);
            margin-left: 2rem;
        }

        .ai-message {
            background-color: rgba(0, 0, 0, 0.2);
            margin-right: 2rem;
        }

        .input-container {
            display: flex;
            position: relative;
        }

        .chat-input {
            flex: 1;
            padding: 1rem;
            border: none;
            background-color: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            color: white;
            font-family: inherit;
            font-size: 1rem;
            outline: none;
            transition: all 0.3s;
        }

        .chat-input::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }

        .chat-input:focus {
            background-color: rgba(255, 255, 255, 0.3);
        }

        .media-upload {
            position: absolute;
            right: 6.5rem;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
            opacity: 0.7;
            transition: all 0.3s;
            z-index: 2;
        }

        .media-upload:hover {
            opacity: 1;
        }

        .send-button {
            margin-left: 0.5rem;
            padding: 0 1.5rem;
            background: linear-gradient(135deg, var(--pink), var(--blue));
            border: none;
            border-radius: 10px;
            color: white;
            font-family: inherit;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            z-index: 1;
            min-width: 70px;
        }

        .send-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .media-preview {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 1rem;
            display: none;
        }

        /* Ripple Effect */
        .ripple {
            position: absolute;
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.3);
            width: 5px;
            height: 5px;
            animation: ripple-effect 1s linear;
            transform: translate(-50%, -50%);
            pointer-events: none;
            z-index: 9999;
        }

        @keyframes ripple-effect {
            0% {
                width: 0;
                height: 0;
                opacity: 0.5;
            }
            100% {
                width: 500px;
                height: 500px;
                opacity: 0;
            }
        }

        .preview-item {
            position: relative;
            width: 80px;
            height: 80px;
            border-radius: 8px;
            overflow: hidden;
            background-color: rgba(255, 255, 255, 0.1);
        }

        .preview-item img,
        .preview-item video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .preview-item .audio-preview {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .remove-media {
            position: absolute;
            top: 5px;
            right: 5px;
            width: 20px;
            height: 20px;
            background-color: rgba(0, 0, 0, 0.5);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.7rem;
            cursor: pointer;
        }

        .file-input {
            display: none;
        }

        @keyframes fadeIn {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes ripple {
            0% {
                transform: scale(0.8);
                opacity: 0;
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        @keyframes dissolve {
            0% {
                opacity: 0;
                filter: blur(10px);
                transform: scale(1.1);
            }
            50% {
                opacity: 1;
                filter: blur(0);
                transform: scale(1);
            }
            100% {
                opacity: 1;
                filter: blur(0);
                transform: scale(1);
            }
        }

        .dissolve-in {
            animation: dissolve 1.5s forwards;
        }

        .footer {
            position: fixed;
            bottom: 1rem;
            left: 0;
            width: 100%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 2rem;
            font-size: 0.8rem;
            opacity: 0.7;
            z-index: 10;
        }

        .footer-left {
            text-align: left;
        }

        .footer-right {
            text-align: right;
        }

        .social-icons {
            display: flex;
            gap: 1rem;
        }

        .social-icon {
            color: white;
            opacity: 0.8;
            transition: all 0.3s;
            text-decoration: none;
        }

        .social-icon:hover {
            opacity: 1;
            transform: translateY(-2px);
        }

        .xiaohongshu {
            font-size: 0.7rem;
            font-weight: bold;
        }

        /* Language switcher */
        .language-switcher {
            display: flex;
            justify-content: center;
            align-items: center;
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 10;
        }

        .lang-btn {
            background: none;
            border: none;
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.9rem;
            cursor: pointer;
            padding: 0.3rem 0.6rem;
            transition: all 0.3s;
        }

        .lang-btn.active {
            color: white;
            font-weight: 600;
        }

        .lang-btn:hover {
            color: white;
        }

        .lang-divider {
            color: rgba(255, 255, 255, 0.5);
            margin: 0 0.3rem;
        }

        /* Navigation */
        .nav-dots {
            display: flex;
            justify-content: center;
            margin-top: 1.5rem;
        }

        .nav-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.3);
            margin: 0 5px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .nav-dot.active {
            background-color: white;
            transform: scale(1.2);
        }

        /* Perfume showcase */
        .page {
            display: none;
        }

        .page.active {
            display: block;
            animation: fadeIn 0.5s forwards;
        }

        .perfume-showcase {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin-top: 2rem;
        }

        .perfume-card {
            position: relative;
            background-color: rgba(0, 0, 0, 0.6);
            border-radius: 15px;
            overflow: hidden;
            height: 400px;
            perspective: 1000px;
            cursor: pointer;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3),
                        0 0 15px rgba(var(--pink-rgb), 0.2),
                        0 0 30px rgba(var(--blue-rgb), 0.1);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.5s ease;
        }

        .perfume-card:hover {
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3),
                        0 0 20px rgba(var(--pink-rgb), 0.3),
                        0 0 40px rgba(var(--blue-rgb), 0.2);
            transform: translateY(-5px);
        }

        .perfume-card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            transition: transform 0.8s;
            transform-style: preserve-3d;
        }

        .perfume-card:hover .perfume-card-inner {
            transform: rotateY(180deg);
        }

        .perfume-front, .perfume-back {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 1.5rem;
            background-color: rgba(0, 0, 0, 0.7);
        }

        .perfume-back {
            transform: rotateY(180deg);
            overflow-y: auto;
            text-align: left;
            background-color: rgba(0, 0, 0, 0.8);
        }

        .perfume-image {
            width: 150px;
            height: 250px;
            object-fit: contain;
            margin-bottom: 1rem;
        }

        .perfume-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .perfume-subtitle {
            font-size: 0.9rem;
            opacity: 0.8;
            margin-bottom: 1rem;
        }

        .perfume-notes h4 {
            margin: 1rem 0 0.5rem 0;
            font-size: 1rem;
            color: var(--pink);
        }

        .perfume-notes ul {
            list-style-type: none;
            padding-left: 0;
            margin: 0;
        }

        .perfume-notes li {
            padding: 0.3rem 0;
            font-size: 0.9rem;
        }

        .perfume-description {
            margin-top: 1rem;
            font-size: 0.9rem;
            line-height: 1.5;
        }

        /* Language content control */
        .zh-content {
            display: none;
        }

        .en-content {
            display: block;
        }

        .section-title {
            font-size: 2rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            text-align: center;
        }

        .section-subtitle {
            font-size: 1rem;
            opacity: 0.8;
            margin-bottom: 2rem;
            text-align: center;
        }

        @media (max-width: 768px) {
            .logo {
                font-size: 3rem;
            }

            .chat-container {
                padding: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <!-- Video Background -->
    <video class="video-bg" id="video-bg" autoplay muted loop playsinline>
    </video>

    <!-- Debug info for video -->
    <div id="video-debug" style="display: none; position: fixed; bottom: 40px; left: 10px; background: rgba(0,0,0,0.7); color: white; padding: 5px; font-size: 12px; z-index: 1000;"></div>

    <!-- Glass Effect -->
    <div class="glass-overlay"></div>

    <div class="language-switcher">
        <button id="en-lang" class="lang-btn active">EN</button>
        <span class="lang-divider">|</span>
        <button id="zh-lang" class="lang-btn">中文</button>
    </div>

    <div class="container">
        <h1 class="logo">Yesterday Once More</h1>

        <!-- Page navigation -->
        <div class="nav-dots">
            <div class="nav-dot active" data-page="chat-page"></div>
            <div class="nav-dot" data-page="perfume-page"></div>
        </div>

        <!-- Chat Page -->
        <div id="chat-page" class="page active">
            <div class="chat-container">
            <div id="chat-messages" class="chat-messages">
                <!-- Messages will appear here -->
            </div>

            <div class="input-container">
                <input type="text" id="chat-input" class="chat-input" placeholder="Describe your perfume inspiration, or upload images, audio, video..." />
                <button id="media-upload" class="media-upload">
                    <i class="fas fa-paperclip"></i>
                </button>
                <input type="file" id="file-input" class="file-input" accept="image/*,audio/*,video/*" multiple />
                <button id="send-button" class="send-button">Send</button>
            </div>

            <div id="media-preview" class="media-preview">
                <!-- Media previews will appear here -->
            </div>
        </div>
        </div>

        <!-- Perfume Page -->
        <div id="perfume-page" class="page">
            <h2 class="section-title">Perfume Collection</h2>
            <p class="section-subtitle">Inspired by Classical Chinese Poetry</p>

            <div class="perfume-showcase">
                <!-- 青玉案·元夕 Perfume -->
                <div class="perfume-card">
                    <div class="perfume-card-inner">
                        <div class="perfume-front">
                            <img src="https://placehold.co/150x250/FF6B6B/FFFFFF?text=Lantern+Festival" class="perfume-image" alt="Lantern Festival Perfume">
                            <h3 class="perfume-title">Lantern Festival</h3>
                            <p class="perfume-subtitle">Inspired by "青玉案·元夕" (Xin Qiji)</p>
                        </div>
                        <div class="perfume-back">
                            <h3 class="perfume-title">元夕花火 (Lantern Festival)</h3>
                            <p class="perfume-subtitle">Inspired by Xin Qiji's "青玉案·元夕"</p>

                            <div class="perfume-notes en-content">
                                <h4 id="top-notes-en">Top Notes: Gunpowder & Plum Wine</h4>
                                <ul>
                                    <li>Byredo's Smoked Birch Tar - Simulates spent fireworks' acrid remnants</li>
                                    <li>Le Labo's Benzoic Acid - Captures chemical burn of exploding firecrackers</li>
                                    <li>Hermès' Aldehydic Citrus - Cold as iced plum wine splashing on copper</li>
                                </ul>

                                <h4>Middle Notes: Fir & Tea Mist</h4>
                                <ul>
                                    <li>Creed's Pine Resin - High-altitude cold detachment of needle-leaf forests</li>
                                    <li>Aesop's Japanese Hinoki - Dry wooden temple beams with zen-like quality</li>
                                    <li>Bvlgari's Tea & Pepper - Steaming tea broth's spiced aromatic vapor</li>
                                </ul>

                                <h4>Base Notes: Iron Rust & Bitter Orange</h4>
                                <ul>
                                    <li>Serge Lutens' Metallic Aldehydes - Sweet tang of rusted church chains</li>
                                    <li>Etat Libre d'Orange's Damp Moss - Iron oxide tang in post-snow soil</li>
                                    <li>Tom Ford's Orange Blossom & Petitgrain - Flowers washed in moonlight</li>
                                </ul>
                            </div>

                            <div class="perfume-notes zh-content">
                                <h4 id="top-notes-zh">前调：硝烟与冷甜的对撞</h4>
                                <ul>
                                    <li>Byredo的烟熏桦木焦油 - 模拟燃放过的烟花残留的刺鼻气息</li>
                                    <li>Le Labo的苯甲酸 - 捕捉爆竹爆炸时的化学灼烧感</li>
                                    <li>Hermès的醛类柑橘 - 冰冷如冰梅酒泼洒在铜器上的感觉</li>
                                </ul>

                                <h4>中调：冷杉与茶雾</h4>
                                <ul>
                                    <li>Creed的松树树脂 - 高海拔针叶林的冷漠疏离感</li>
                                    <li>Aesop的日本檀木 - 干燥的寺庙木梁带有禅意的质感</li>
                                    <li>Bvlgari的茶与胡椒 - 冒着热气的茶汤中带有香料的芳香蒸汽</li>
                                </ul>

                                <h4>基调：铁锈与苦橙</h4>
                                <ul>
                                    <li>Serge Lutens的金属醛类 - 生锈教堂铁链的甜涩气息</li>
                                    <li>Etat Libre d'Orange的湿苔藓 - 雪后土壤中的氧化铁气息</li>
                                    <li>Tom Ford的橙花与苦橙叶 - 被月光洗涌过的花朵</li>
                                </ul>
                            </div>

                            <div class="perfume-description en-content">
                                <p>Housed in a matte black ceramic bottle with gold crackle inlay, this fragrance begins with snowy plum blossoms and gunpowder, transitions to temple incense and tea steam, and settles into the metallic tang of horseshoe rust with bitter orange. The bottle reveals Xin Qiji's famous verse "众里寻他千百度，蓦然回首，那人却在，灯火阑珊处" only when nearly empty—a poignant reminder that what we seek is often found when we least expect it.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="config.js"></script>
    <script src="api.js"></script>
    <script>
        // Video Background Management
        // 使用视频背景
        const useStaticBackground = false;

        // 视频背景列表
        const videoBackgrounds = [
            "videos/background.mp4" // 使用相对路径，视频文件将放在网站的videos文件夹中
        ];

        // 当前播放的视频索引
        let currentVideoIndex = 0;

        // Debug function
        function showDebug(message) {
            const debugElement = document.getElementById('video-debug');
            debugElement.style.display = 'block';
            debugElement.innerHTML += message + '<br>';
            console.log(message);
        }

        // Check if video file exists
        async function checkVideoExists(url) {
            try {
                const response = await fetch(url, { method: 'HEAD' });
                return response.ok;
            } catch (error) {
                showDebug(`Error checking video: ${error.message}`);
                return false;
            }
        }

        // 移除渐变背景
        function removeGradientBackground() {
            // 移除动画类
            document.body.classList.remove('animated-bg');

            // 重置背景样式
            document.body.style.background = '';
            document.body.style.backgroundSize = '';
            document.body.style.backgroundAttachment = '';

            // 显示视频元素
            const videoBg = document.getElementById('video-bg');
            videoBg.style.display = 'block';

            showDebug('Removed gradient background');

            // 隐藏调试信息
            setTimeout(() => {
                const debugElement = document.getElementById('video-debug');
                debugElement.style.display = 'none';
            }, 3000);

            return true;
        }

        // 播放指定索引的视频
        async function playVideo(index) {
            // 移除渐变背景
            removeGradientBackground();

            const videoBg = document.getElementById('video-bg');
            showDebug(`Setting up video ${index + 1} of ${videoBackgrounds.length}...`);

            // 使用指定的视频文件
            const videoSource = videoBackgrounds[index];
            showDebug(`Loading video: ${videoSource}`);

            // 创建并添加source元素
            const sourceElement = document.createElement('source');
            sourceElement.src = videoSource;
            sourceElement.type = 'video/mp4';
            videoBg.innerHTML = ''; // 清除现有源
            videoBg.appendChild(sourceElement);

            // 加载并播放视频
            videoBg.load();
            try {
                await videoBg.play();
                showDebug(`Successfully playing video: ${videoSource}`);
                return true; // 成功
            } catch (error) {
                showDebug(`Error playing video: ${error.message}`);
                return false;
            }
        }

        // 页面加载时设置背景
        window.addEventListener('DOMContentLoaded', async () => {
            try {
                // 播放视频
                await playVideo(0);

                // 添加视频事件监听器
                const videoBg = document.getElementById('video-bg');
                videoBg.addEventListener('playing', () => console.log('Video is playing'));
                videoBg.addEventListener('error', (e) => {
                    console.error(`Video error: ${e}`);
                });

                // 隐藏调试信息
                setTimeout(() => {
                    const debugElement = document.getElementById('video-debug');
                    debugElement.style.display = 'none';
                }, 3000);
            } catch (error) {
                console.error(`Error in video setup: ${error.message}`);
            }
        });

        // DOM Elements
        const chatInput = document.getElementById('chat-input');
        const sendButton = document.getElementById('send-button');
        const chatMessages = document.getElementById('chat-messages');
        const mediaUpload = document.getElementById('media-upload');
        const fileInput = document.getElementById('file-input');
        const mediaPreview = document.getElementById('media-preview');
        const gradientBg = document.querySelector('.gradient-bg');

        // Store uploaded files
        let uploadedFiles = [];

        // Dynamic background colors
        const colors = [
            { pink: '#FF6B6B', pinkRgb: '255, 107, 107', blue: '#00C4CC', blueRgb: '0, 196, 204' }, // Default - Sunburn Pink & Chlorine Blue
            { pink: '#FF9E7D', pinkRgb: '255, 158, 125', blue: '#7D67FF', blueRgb: '125, 103, 255' }, // Sunset & Twilight
            { pink: '#FF5E87', pinkRgb: '255, 94, 135', blue: '#00D9B8', blueRgb: '0, 217, 184' }, // Neon Pink & Mint
            { pink: '#FF7EB3', pinkRgb: '255, 126, 179', blue: '#7B68EE', blueRgb: '123, 104, 238' }, // Bubblegum & Lavender
            { pink: '#FF8C42', pinkRgb: '255, 140, 66', blue: '#0096C7', blueRgb: '0, 150, 199' }  // Tangerine & Ocean
        ];

        let colorIndex = 0;

        // Change background colors periodically
        function changeBackgroundColor() {
            colorIndex = (colorIndex + 1) % colors.length;
            const newColors = colors[colorIndex];

            document.documentElement.style.setProperty('--pink', newColors.pink);
            document.documentElement.style.setProperty('--pink-rgb', newColors.pinkRgb);
            document.documentElement.style.setProperty('--blue', newColors.blue);
            document.documentElement.style.setProperty('--blue-rgb', newColors.blueRgb);
        }

        // Set interval for color change (every 30 seconds)
        setInterval(changeBackgroundColor, 30000);

        // Add ripple effect on click
        document.addEventListener('click', function(e) {
            const ripple = document.createElement('div');
            ripple.classList.add('ripple');
            ripple.style.left = e.clientX + 'px';
            ripple.style.top = e.clientY + 'px';
            document.body.appendChild(ripple);

            setTimeout(() => {
                ripple.remove();
            }, 1000);
        });

        // Media upload handling
        mediaUpload.addEventListener('click', () => {
            fileInput.click();
        });

        fileInput.addEventListener('change', (e) => {
            const files = Array.from(e.target.files);
            if (files.length === 0) return;

            // Add files to the uploadedFiles array
            uploadedFiles = [...uploadedFiles, ...files];

            // Show media preview
            updateMediaPreview();
        });

        // Update media preview
        function updateMediaPreview() {
            // Clear current preview
            mediaPreview.innerHTML = '';

            if (uploadedFiles.length === 0) {
                mediaPreview.style.display = 'none';
                return;
            }

            // Show preview container
            mediaPreview.style.display = 'flex';

            // Add preview for each file
            uploadedFiles.forEach((file, index) => {
                const previewItem = document.createElement('div');
                previewItem.className = 'preview-item';

                if (file.type.startsWith('image/')) {
                    // Image preview
                    const img = document.createElement('img');
                    img.src = URL.createObjectURL(file);
                    previewItem.appendChild(img);
                } else if (file.type.startsWith('audio/')) {
                    // Audio preview
                    const audioPreview = document.createElement('div');
                    audioPreview.className = 'audio-preview';
                    audioPreview.innerHTML = '<i class="fas fa-music"></i>';
                    previewItem.appendChild(audioPreview);
                } else if (file.type.startsWith('video/')) {
                    // Video preview
                    const video = document.createElement('video');
                    video.src = URL.createObjectURL(file);
                    video.muted = true;
                    previewItem.appendChild(video);
                }

                // Add remove button
                const removeBtn = document.createElement('div');
                removeBtn.className = 'remove-media';
                removeBtn.innerHTML = '<i class="fas fa-times"></i>';
                removeBtn.addEventListener('click', () => {
                    uploadedFiles.splice(index, 1);
                    updateMediaPreview();
                });

                previewItem.appendChild(removeBtn);
                mediaPreview.appendChild(previewItem);
            });
        }

        // Add a typing indicator
        function addTypingIndicator() {
            // Show chat messages container if it's hidden
            if (chatMessages.style.display === 'none' || !chatMessages.style.display) {
                chatMessages.style.display = 'block';
            }

            const indicatorDiv = document.createElement('div');
            indicatorDiv.id = 'typing-indicator';
            indicatorDiv.className = 'message ai-message';
            indicatorDiv.innerHTML = `
                <div class="typing-indicator">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            `;
            chatMessages.appendChild(indicatorDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // Remove typing indicator
        function removeTypingIndicator() {
            const indicator = document.getElementById('typing-indicator');
            if (indicator) {
                indicator.remove();
            }
        }

        // Add a message to the chat
        function addMessage(message, isUser = false, mediaFiles = []) {
            // Show chat messages container if it's hidden
            if (chatMessages.style.display === 'none' || !chatMessages.style.display) {
                chatMessages.style.display = 'block';
            }

            const messageDiv = document.createElement('div');
            messageDiv.className = isUser ? 'message user-message' : 'message ai-message';

            // Handle HTML content for formatted responses
            if (message.includes('<') && message.includes('>')) {
                messageDiv.innerHTML = message;
            } else {
                messageDiv.textContent = message;
            }

            // Add media files if any
            if (mediaFiles.length > 0) {
                const mediaContainer = document.createElement('div');
                mediaContainer.className = 'message-media';

                mediaFiles.forEach(file => {
                    if (file.type.startsWith('image/')) {
                        // Image file
                        const img = document.createElement('img');
                        img.src = URL.createObjectURL(file);
                        img.style.maxWidth = '100%';
                        img.style.borderRadius = '8px';
                        img.style.marginTop = '0.5rem';
                        mediaContainer.appendChild(img);
                    } else if (file.type.startsWith('audio/')) {
                        // Audio file
                        const audio = document.createElement('audio');
                        audio.src = URL.createObjectURL(file);
                        audio.controls = true;
                        audio.style.width = '100%';
                        audio.style.marginTop = '0.5rem';
                        mediaContainer.appendChild(audio);
                    } else if (file.type.startsWith('video/')) {
                        // Video file
                        const video = document.createElement('video');
                        video.src = URL.createObjectURL(file);
                        video.controls = true;
                        video.style.maxWidth = '100%';
                        video.style.borderRadius = '8px';
                        video.style.marginTop = '0.5rem';
                        mediaContainer.appendChild(video);
                    }
                });

                messageDiv.appendChild(mediaContainer);
            }

            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;

            // Apply dissolve effect
            messageDiv.classList.add('dissolve-in');
        }

        // Format the AI response to highlight perfume notes
        function formatPerfumeResponse(text) {
            // Replace note sections with formatted versions
            text = text.replace(/顶调[：:](.*?)(?=\n\n|\n[^\n]|$)/s, '<strong>顶调:</strong>$1');
            text = text.replace(/中调[：:](.*?)(?=\n\n|\n[^\n]|$)/s, '<strong>中调:</strong>$1');
            text = text.replace(/基调[：:](.*?)(?=\n\n|\n[^\n]|$)/s, '<strong>基调:</strong>$1');

            // Convert line breaks to paragraphs
            const paragraphs = text.split('\n\n').filter(p => p.trim() !== '');
            return paragraphs.map(p => `<p>${p.replace(/\n/g, '<br>')}</p>`).join('');
        }

        // Send a message to the DeepSeek API
        async function sendToDeepSeekAPI(userMessage, mediaFiles = []) {
            try {
                addTypingIndicator();

                // Prepare the message for API
                let apiMessage = userMessage;

                // Add descriptions of media files
                if (mediaFiles.length > 0) {
                    apiMessage += '\n\n[附带的媒体文件: ' +
                        mediaFiles.map(file => {
                            const type = file.type.split('/')[0];
                            return `${type === 'image' ? '图片' : type === 'audio' ? '音频' : '视频'} (${file.name})`;
                        }).join(', ') + ']';
                }

                console.log('Sending message to DeepSeek API:', apiMessage);

                const response = await fetch('https://api.deepseek.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${window.CONFIG ? window.CONFIG.DEEPSEEK_API_KEY : window.YesterdayOnceMoreAPI ? window.YesterdayOnceMoreAPI.DEEPSEEK_API_KEY : 'YOUR_API_KEY_HERE'}`
                    },
                    body: JSON.stringify({
                        model: window.CONFIG ? window.CONFIG.DEEPSEEK_MODEL : window.YesterdayOnceMoreAPI ? window.YesterdayOnceMoreAPI.DEEPSEEK_MODEL : 'deepseek-V3',
                        messages: [
                            {
                                role: 'system',
                                content: '你是昨日重现（Yesterday Once More）的AI助手，一个专注于创建独特香水配方的虚拟顾问。你擅长分析用户的描述、图片、音频和视频，并将其转化为香水配方。你的回答应该富有创意，同时保持专业性，使用香水行业的术语。你的风格应该既有诗意又有科学性，能够唤起人们对过去美好时光的怀念，同时展现香水的艺术性和科学性。'
                            },
                            {
                                role: 'user',
                                content: apiMessage
                            }
                        ],
                        temperature: 0.7,
                        max_tokens: 800
                    })
                });

                removeTypingIndicator();

                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('API error:', errorText);
                    addMessage('抱歉，我在连接到 DeepSeek API 时遇到了问题。请检查你的 API 密钥并稍后再试。', false);
                    return;
                }

                const data = await response.json();
                console.log('API response:', data);

                if (!data.choices || !data.choices[0] || !data.choices[0].message) {
                    console.error('Unexpected API response format:', data);
                    addMessage('抱歉，我收到了意外的响应格式。请再试一次。', false);
                    return;
                }

                const aiResponse = data.choices[0].message.content;

                // Format the response to highlight perfume notes
                const formattedResponse = formatPerfumeResponse(aiResponse);

                addMessage(formattedResponse, false);
            } catch (error) {
                removeTypingIndicator();
                console.error('Error sending message:', error);

                // Fallback response
                let fallbackResponse;

                if (mediaFiles.length > 0) {
                    fallbackResponse = "<p>我分析了你上传的媒体，这让我想到一款香水配方：</p><p><strong>顶调:</strong> 柑橘、佛手柑、海盐</p><p><strong>中调:</strong> 茉莉、紫罗兰叶、水生调</p><p><strong>基调:</strong> 琥珀、麝香、雪松</p><p>这款香水捕捉了昨日的美好回忆，既有清新的水感，又有温暖的基调，就像在回忆中重游美好的时光。</p>";
                } else if (userMessage.toLowerCase().includes('香水') || userMessage.toLowerCase().includes('气味') || userMessage.toLowerCase().includes('香气')) {
                    fallbackResponse = "<p>基于你的描述，我推荐这款香水配方：</p><p><strong>顶调:</strong> 柠檬、葡萄柚、薄荷</p><p><strong>中调:</strong> 玫瑰、铃兰、海洋调</p><p><strong>基调:</strong> 广藿香、香根草、琥珀</p><p>这款香水融合了清新与深沉，就像在回忆中重游美好的时光，既有怀旧的温暖，又有新鲜的生机。</p>";
                } else {
                    fallbackResponse = translations[currentLang].welcome;
                }

                addMessage(fallbackResponse, false);
            }
        }

        // Send message
        function sendMessage() {
            const message = chatInput.value.trim();

            if (!message && uploadedFiles.length === 0) {
                return;
            }

            // Add user message to chat
            addMessage(message, true, uploadedFiles);

            // Clear input
            chatInput.value = '';

            // Keep a copy of uploaded files for display
            const sentFiles = [...uploadedFiles];

            // Clear uploaded files
            uploadedFiles = [];
            updateMediaPreview();

            // Send to API
            sendToDeepSeekAPI(message, sentFiles);
        }

        // Event listeners
        sendButton.addEventListener('click', sendMessage);

        chatInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        // Language switching
        const enLangBtn = document.getElementById('en-lang');
        const zhLangBtn = document.getElementById('zh-lang');

        // Default language is English
        let currentLang = 'en';

        // Text content for different languages
        const translations = {
            en: {
                welcome: "Welcome to Yesterday Once More. I can help you create unique perfume formulations by analyzing your descriptions, images, audio, or video. Tell me what kind of perfume you'd like, or upload media for inspiration.",
                inputPlaceholder: "Describe your perfume inspiration, or upload images, audio, video...",
                sendButton: "Send",
                perfumeTitle: "Perfume Collection",
                perfumeSubtitle: "Inspired by Classical Chinese Poetry",
                siteTitle: "Yesterday Once More",
                perfumeName: "Lantern Festival",
                perfumePoem: "Inspired by \"青玉案·元夕\" (Xin Qiji)",
                topNotesTitle: "Top Notes: Gunpowder & Plum Wine"
            },
            zh: {
                welcome: "欢迎来到昨日重现香氛体验。我可以帮你创建独特的香水配方，分析图片、音频或视频中的情绪，并将其转化为香调。请告诉我你想要什么样的香水，或上传媒体让我获取灵感。",
                inputPlaceholder: "描述你的香水灵感，或上传图片、音频、视频...",
                sendButton: "发送",
                perfumeTitle: "香水系列",
                perfumeSubtitle: "灵感源自中国古典诗词",
                siteTitle: "昨日重现",
                perfumeName: "元夕花火",
                perfumePoem: "灵感源自辛弃疾《青玉案·元夕》",
                topNotesTitle: "前调：硝烟与冷甜的对撞"
            }
        };

        // Update UI language
        function updateLanguage(lang) {
            currentLang = lang;

            // Update active button
            if (lang === 'en') {
                enLangBtn.classList.add('active');
                zhLangBtn.classList.remove('active');

                // Show English content, hide Chinese content
                document.querySelectorAll('.en-content').forEach(el => el.style.display = 'block');
                document.querySelectorAll('.zh-content').forEach(el => el.style.display = 'none');
            } else {
                zhLangBtn.classList.add('active');
                enLangBtn.classList.remove('active');

                // Show Chinese content, hide English content
                document.querySelectorAll('.en-content').forEach(el => el.style.display = 'none');
                document.querySelectorAll('.zh-content').forEach(el => el.style.display = 'block');
            }

            // Update placeholder and button text
            document.getElementById('chat-input').placeholder = translations[lang].inputPlaceholder;
            document.getElementById('send-button').textContent = translations[lang].sendButton;

            // Update site title
            document.querySelector('.logo').textContent = translations[lang].siteTitle;

            // Update perfume page titles
            document.querySelector('.section-title').textContent = translations[lang].perfumeTitle;
            document.querySelector('.section-subtitle').textContent = translations[lang].perfumeSubtitle;

            // Update perfume details
            document.querySelector('.perfume-front .perfume-title').textContent = translations[lang].perfumeName;
            document.querySelector('.perfume-front .perfume-subtitle').textContent = translations[lang].perfumePoem;
            document.querySelector('.perfume-back .perfume-title').textContent = translations[lang].perfumeName;
            document.querySelector('.perfume-back .perfume-subtitle').textContent = translations[lang].perfumePoem;

            // Update perfume notes titles
            document.getElementById('top-notes-en').textContent = translations['en'].topNotesTitle;
            document.getElementById('top-notes-zh').textContent = translations['zh'].topNotesTitle;

            // Update welcome message if it's the only message in the chat
            const chatMessages = document.getElementById('chat-messages');
            if (chatMessages.children.length === 1 && chatMessages.children[0].classList.contains('ai-message')) {
                chatMessages.innerHTML = '';
                addMessage(translations[lang].welcome, false);
            }
        }

        // Language button event listeners
        enLangBtn.addEventListener('click', () => updateLanguage('en'));
        zhLangBtn.addEventListener('click', () => updateLanguage('zh'));

        // Page navigation
        const navDots = document.querySelectorAll('.nav-dot');
        const pages = document.querySelectorAll('.page');

        navDots.forEach(dot => {
            dot.addEventListener('click', () => {
                const targetPage = dot.getAttribute('data-page');

                // Update active dot
                navDots.forEach(d => d.classList.remove('active'));
                dot.classList.add('active');

                // Show target page
                pages.forEach(page => {
                    if (page.id === targetPage) {
                        page.classList.add('active');
                    } else {
                        page.classList.remove('active');
                    }
                });
            });
        });

        // Initialize language to English
        updateLanguage('en');

        // Add initial message after a delay
        setTimeout(() => {
            addMessage(translations[currentLang].welcome, false);
        }, 2000);
    </script>

    <div class="footer">
        <div class="footer-left">
            © 2023 Yesterday Once More
        </div>
        <div class="footer-right">
            <div class="social-icons">
                <a href="#" class="social-icon"><i class="fab fa-linkedin-in"></i></a>
                <a href="#" class="social-icon"><i class="fab fa-twitter"></i></a>
                <a href="#" class="social-icon"><i class="fab fa-instagram"></i></a>
                <a href="#" class="social-icon"><i class="fab fa-tiktok"></i></a>
                <a href="#" class="social-icon"><span class="xiaohongshu">小红书</span></a>
            </div>
        </div>
    </div>
</body>
</html>
