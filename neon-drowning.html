<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yesterday Once More | 昨日重现</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #333;
            --text-color: #fff;
            --transition-speed: 0.3s;
            --pink: #FF6B6B;
            --pink-rgb: 255, 107, 107;
            --blue: #00C4CC;
            --blue-rgb: 0, 196, 204;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Space Grotesk', sans-serif;
            height: 100vh;
            overflow: hidden;
            background: var(--bg-color);
            color: var(--text-color);
        }

        .video-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%; /* 覆盖全屏 */
            height: 100%; /* 覆盖全屏 */
            object-fit: cover; /* 保持纵横比例的同时填充全屏 */
            z-index: -2;
            opacity: 1;
            filter: contrast(1.1) brightness(0.9); /* 增强对比度 */
            overflow: hidden; /* 防止内容溢出 */
        }

        /* YouTube iframe 样式 */
        #video-container iframe {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 100vw;
            height: 100vh;
            pointer-events: none; /* 禁止点击视频 */
        }

        .glass-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            backdrop-filter: blur(1px);
            -webkit-backdrop-filter: blur(1px);
            background-color: rgba(0, 0, 0, 0.2);
            z-index: -1;
            pointer-events: none;
        }





        .container {
            display: flex;
            flex-direction: column; /* Changed to column for centered title */
            justify-content: flex-start;
            align-items: center; /* Center align everything */
            min-height: calc(100vh - 10rem);
            padding: 2rem;
            position: relative;
            z-index: 1;
            width: 100%; /* Use full width */
            max-width: 1600px; /* Increased max-width */
            margin: 0 auto;
        }

        .quote-container {
            width: 80%;
            max-width: 800px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            text-align: center;
            margin: 2rem auto;
        }

        .chat-section {
            width: 80%;
            max-width: 800px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            margin: 0 auto;
        }

        .logo {
            font-size: 4rem;
            font-weight: 700;
            letter-spacing: -0.05em;
            margin: 2rem 0;
            text-align: center;
            width: 100%;
            opacity: 1;
            color: white;
            text-transform: lowercase;
            line-height: 0.9;
            position: relative;
            z-index: 10;
        }

        .quote-text {
            font-size: 1.1rem;
            line-height: 1.8;
            margin-bottom: 2rem;
            text-align: center;
            color: rgba(255, 255, 255, 0.9);
            max-width: 100%;
        }

        @keyframes glowPulse {
            0% {
                opacity: 0.3;
                filter: blur(8px);
            }
            100% {
                opacity: 0.7;
                filter: blur(12px);
            }
        }

        .tagline {
            font-size: 1.2rem;
            font-weight: 300;
            margin-bottom: 3rem;
            text-align: center;
            max-width: 600px;
            opacity: 0;
            transform: translateY(20px);
            animation: fadeIn 1s forwards 0.8s;
        }

        .chat-container {
            width: 100%;
            max-width: 800px;
            background-color: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            padding: 2rem;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
            opacity: 1;
            border: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
            overflow: hidden;
        }

        .chat-container::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg,
                        transparent,
                        rgba(255, 255, 255, 0.03),
                        transparent);
            transform: rotate(45deg);
            animation: glassSweep 10s linear infinite;
            pointer-events: none;
        }

        @keyframes glassSweep {
            0% {
                transform: rotate(45deg) translateY(-100%);
            }
            100% {
                transform: rotate(45deg) translateY(100%);
            }
        }

        .chat-messages {
            max-height: 300px;
            overflow-y: auto;
            margin-bottom: 1.5rem;
            padding-right: 0.5rem;
            display: none;
        }

        /* Typing indicator */
        .typing-indicator {
            display: inline-flex;
            align-items: center;
            margin: 0.5rem 0;
        }

        .typing-indicator span {
            height: 8px;
            width: 8px;
            background-color: white;
            border-radius: 50%;
            margin: 0 2px;
            animation: bounce 1.5s infinite ease-in-out;
        }

        .typing-indicator span:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-indicator span:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes bounce {
            0%, 60%, 100% {
                transform: translateY(0);
            }
            30% {
                transform: translateY(-4px);
            }
        }

        .chat-messages::-webkit-scrollbar {
            width: 4px;
        }

        .chat-messages::-webkit-scrollbar-thumb {
            background-color: rgba(255, 255, 255, 0.3);
            border-radius: 2px;
        }

        .message {
            margin-bottom: 1rem;
            padding: 1rem;
            border-radius: 10px;
            animation: ripple 0.5s ease-out;
        }

        .user-message {
            background-color: rgba(255, 255, 255, 0.2);
            margin-left: 2rem;
        }

        .ai-message {
            background-color: rgba(0, 0, 0, 0.2);
            margin-right: 2rem;
        }

        .input-container {
            display: flex;
            position: relative;
        }

        .chat-input {
            flex: 1;
            padding: 1rem;
            border: none;
            background-color: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            color: white;
            font-family: inherit;
            font-size: 1rem;
            outline: none;
            transition: all 0.3s;
        }

        .chat-input::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }

        .chat-input:focus {
            background-color: rgba(255, 255, 255, 0.3);
        }

        .media-upload {
            position: absolute;
            right: 6.5rem;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
            opacity: 0.7;
            transition: all 0.3s;
            z-index: 2;
        }

        .media-upload:hover {
            opacity: 1;
        }

        .send-button {
            margin-left: 0.5rem;
            padding: 0 1.5rem;
            background: linear-gradient(135deg, var(--pink), var(--blue));
            border: none;
            border-radius: 10px;
            color: white;
            font-family: inherit;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            z-index: 1;
            min-width: 70px;
        }

        .send-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .media-preview {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 1rem;
            display: none;
        }

        /* Ripple Effect */
        .ripple {
            position: absolute;
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.3);
            width: 5px;
            height: 5px;
            animation: ripple-effect 1s linear;
            transform: translate(-50%, -50%);
            pointer-events: none;
            z-index: 9999;
        }

        @keyframes ripple-effect {
            0% {
                width: 0;
                height: 0;
                opacity: 0.5;
            }
            100% {
                width: 500px;
                height: 500px;
                opacity: 0;
            }
        }

        .preview-item {
            position: relative;
            width: 80px;
            height: 80px;
            border-radius: 8px;
            overflow: hidden;
            background-color: rgba(255, 255, 255, 0.1);
        }

        .preview-item img,
        .preview-item video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .preview-item .audio-preview {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .remove-media {
            position: absolute;
            top: 5px;
            right: 5px;
            width: 20px;
            height: 20px;
            background-color: rgba(0, 0, 0, 0.5);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.7rem;
            cursor: pointer;
        }

        .file-input {
            display: none;
        }

        @keyframes fadeIn {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes ripple {
            0% {
                transform: scale(0.8);
                opacity: 0;
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        @keyframes dissolve {
            0% {
                opacity: 0;
                filter: blur(10px);
                transform: scale(1.1);
            }
            50% {
                opacity: 1;
                filter: blur(0);
                transform: scale(1);
            }
            100% {
                opacity: 1;
                filter: blur(0);
                transform: scale(1);
            }
        }

        .dissolve-in {
            animation: dissolve 1.5s forwards;
        }

        .footer {
            position: fixed;
            bottom: 1rem;
            left: 0;
            width: 100%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 2rem;
            font-size: 0.8rem;
            opacity: 0.7;
            z-index: 10;
        }

        .footer-left {
            text-align: left;
        }

        .footer-right {
            text-align: right;
        }

        .social-icons {
            display: flex;
            gap: 1rem;
        }

        .social-icon {
            color: white;
            opacity: 0.8;
            transition: all 0.3s;
            text-decoration: none;
        }

        .social-icon:hover {
            opacity: 1;
            transform: translateY(-2px);
        }

        .xiaohongshu {
            font-size: 0.7rem;
            font-weight: bold;
        }

        /* Language switcher */
        .language-switcher {
            display: flex;
            justify-content: center;
            align-items: center;
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 10;
        }

        .lang-btn {
            background: none;
            border: none;
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.9rem;
            cursor: pointer;
            padding: 0.3rem 0.6rem;
            transition: all 0.3s;
        }

        .lang-btn.active {
            color: white;
            font-weight: 600;
        }

        .lang-btn:hover {
            color: white;
        }

        .lang-divider {
            color: rgba(255, 255, 255, 0.5);
            margin: 0 0.3rem;
        }

        /* 移除导航点相关的CSS */

        /* 移除香水展示相关的CSS */
        .page {
            display: block;
        }

        /* 移除香水描述相关的CSS */

        /* Language content control */
        .zh-content {
            display: none;
        }

        .en-content {
            display: block;
        }

        /* 移除香水展示相关的标题样式 */

        @media (max-width: 768px) {
            .logo {
                font-size: 3rem;
            }

            .chat-container {
                padding: 1.5rem;
            }

            .container {
                flex-direction: column;
                padding: 2rem 1rem;
            }

            .content-left, .content-right {
                width: 100%;
                padding-right: 0;
                padding-top: 2rem;
            }

            .content-left {
                margin-bottom: 2rem;
            }

            .quote-text {
                font-size: 1rem;
                margin-bottom: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <!-- Video Background -->
    <div id="video-container" class="video-bg">
        <!-- YouTube iframe will be inserted here by JavaScript -->
    </div>
    <!-- Fallback video (used if YouTube fails) -->
    <video class="video-bg" id="video-bg" autoplay muted loop playsinline>
    </video>

    <!-- Debug info for video -->
    <!-- 移除调试信息 -->

    <!-- Glass Effect -->
    <div class="glass-overlay"></div>

    <div class="language-switcher">
        <button id="en-lang" class="lang-btn active">EN</button>
        <span class="lang-divider">|</span>
        <button id="zh-lang" class="lang-btn">中文</button>
    </div>

    <h1 class="logo">Yesterday<br>Once More</h1>

    <div class="container">
        <div class="quote-container">
            <div class="quote-text en-content">
                Scent is the only sensory input that directly affects emotions through the limbic system. When deeply associated with specific contexts, it can instantly remind you of a person or event - a phenomenon known as the Proustian effect. Find scents you love and record them in your life manual. Use one scent to preserve the present moment, and another to evoke the past. Slowly understand yourself, record yourself, use yourself well, and fall in love with yourself.
            </div>
            <div class="quote-text zh-content">
                气味是唯一一种直接通过边缘系统影响情绪的感官输入，当它与特定情境深度关联，会瞬间让你想到某个人或是事，这种现象被称为Proustian( 普鲁斯特效应  )。去寻找自己喜欢的气味，记录在人生说明书里，一味香用来备份当下，一味香试着唤起过往，慢慢了解自己、记录自己、用好自己、爱上自己。
            </div>
        </div>

        <div class="chat-section">

            <!-- 移除导航点 -->

            <!-- Chat Container -->
            <div class="chat-container">
                <div id="chat-messages" class="chat-messages">
                    <!-- Messages will appear here -->
                </div>

                <div class="input-container">
                    <input type="text" id="chat-input" class="chat-input" placeholder="Type your message here..." />
                    <button id="media-upload" class="media-upload">
                        <i class="fas fa-paperclip"></i>
                    </button>
                    <input type="file" id="file-input" class="file-input" accept="image/*,audio/*,video/*" multiple />
                    <button id="send-button" class="send-button">Send</button>
                </div>

                <div id="media-preview" class="media-preview">
                    <!-- Media previews will appear here -->
                </div>
            </div>
        </div>
    </div>

    <script src="config.js"></script>
    <script src="api.js"></script>
    <script>
        // Video Background Management
        // 使用视频背景
        const useStaticBackground = false;

        // YouTube视频ID
        const youtubeVideoId = 'VKN2IdE-2KA'; // 您的YouTube视频ID

        // 本地视频背景列表
        const videoBackgrounds = [
            "videos/background.mp4", // GitHub Pages上使用的相对路径
            "C:/Users/LXH20/Videos/4月9日.mp4" // 本地开发时使用的绝对路径
        ];

        // 当前播放的视频索引
        let currentVideoIndex = 0;

        // 检测当前环境
        function isGitHubPages() {
            return window.location.hostname.includes('github.io');
        }

        // 初始化视频背景
        function initVideoBackground() {
            if (isGitHubPages()) {
                // 在GitHub Pages上使用YouTube视频
                showDebug('Running on GitHub Pages, using YouTube video');
                initYouTubeBackground();
            } else {
                // 在本地使用本地视频
                showDebug('Running locally, using local video');
                document.getElementById('video-container').style.display = 'none';
                const videoBg = document.getElementById('video-bg');
                videoBg.style.display = 'block';
                playVideo(0);
            }
        }

        // 初始化YouTube背景
        function initYouTubeBackground() {
            loadYouTubeAPI();
        }

        // 加载YouTube API
        function loadYouTubeAPI() {
            const tag = document.createElement('script');
            tag.src = 'https://www.youtube.com/iframe_api';
            const firstScriptTag = document.getElementsByTagName('script')[0];
            firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
        }

        // 初始化YouTube播放器
        let youtubePlayer;
        function onYouTubeIframeAPIReady() {
            showDebug('YouTube API ready');
            youtubePlayer = new YT.Player('video-container', {
                videoId: youtubeVideoId,
                playerVars: {
                    autoplay: 1,
                    controls: 0,
                    disablekb: 1,
                    fs: 0,
                    modestbranding: 1,
                    loop: 1,
                    playlist: youtubeVideoId, // 需要重复指定videoId才能循环播放
                    rel: 0,
                    showinfo: 0,
                    mute: 1
                },
                events: {
                    'onReady': onPlayerReady,
                    'onStateChange': onPlayerStateChange,
                    'onError': onPlayerError
                }
            });
        }

        // 播放器准备好时
        function onPlayerReady(event) {
            showDebug('YouTube player ready');
            event.target.playVideo();
            // 设置播放器样式
            const iframe = document.querySelector('#video-container iframe');
            if (iframe) {
                iframe.style.position = 'absolute';
                iframe.style.top = '50%';
                iframe.style.left = '50%';
                iframe.style.transform = 'translate(-50%, -50%)';
                iframe.style.width = '100vw';
                iframe.style.height = '100vh';
                iframe.style.pointerEvents = 'none';
            }
        }

        // 播放器状态改变时
        function onPlayerStateChange(event) {
            // 如果视频结束，重新播放
            if (event.data === YT.PlayerState.ENDED) {
                event.target.playVideo();
            }
        }

        // 播放器错误时
        function onPlayerError(event) {
            showDebug(`YouTube player error: ${event.data}`);
            // 如果YouTube播放失败，切换到本地视频
            fallbackToLocalVideo();
        }

        // 切换到本地视频
        function fallbackToLocalVideo() {
            showDebug('Falling back to local video');
            document.getElementById('video-container').style.display = 'none';
            const videoBg = document.getElementById('video-bg');
            videoBg.style.display = 'block';
            playVideo(0);
        }

        // 初始化视频背景
        initVideoBackground();

        // Debug function - 只在控制台输出，不在页面显示
        function showDebug(message) {
            console.log(message);
        }

        // Check if video file exists
        async function checkVideoExists(url) {
            try {
                const response = await fetch(url, { method: 'HEAD' });
                return response.ok;
            } catch (error) {
                showDebug(`Error checking video: ${error.message}`);
                return false;
            }
        }

        // 移除渐变背景
        function removeGradientBackground() {
            // 移除动画类
            document.body.classList.remove('animated-bg');

            // 重置背景样式
            document.body.style.background = '';
            document.body.style.backgroundSize = '';
            document.body.style.backgroundAttachment = '';

            // 显示视频元素
            const videoBg = document.getElementById('video-bg');
            videoBg.style.display = 'block';

            showDebug('Removed gradient background');

            // 不需要隐藏调试信息，因为它只在控制台输出

            return true;
        }

        // 播放指定索引的视频
        async function playVideo(index) {
            // 移除渐变背景
            removeGradientBackground();

            const videoBg = document.getElementById('video-bg');
            showDebug(`Setting up video ${index + 1} of ${videoBackgrounds.length}...`);

            // 使用指定的视频文件
            const videoSource = videoBackgrounds[index];
            showDebug(`Loading video: ${videoSource}`);

            // 创建并添加source元素
            const sourceElement = document.createElement('source');
            sourceElement.src = videoSource;
            sourceElement.type = 'video/mp4';
            videoBg.innerHTML = ''; // 清除现有源
            videoBg.appendChild(sourceElement);

            // 加载并播放视频
            videoBg.load();
            try {
                await videoBg.play();
                showDebug(`Successfully playing video: ${videoSource}`);
                return true; // 成功
            } catch (error) {
                showDebug(`Error playing video: ${error.message}`);
                // 尝试播放下一个视频
                if (index < videoBackgrounds.length - 1) {
                    return playVideo(index + 1);
                }
                return false;
            }
        }

        // 页面加载时设置背景
        window.addEventListener('DOMContentLoaded', async () => {
            try {
                // 不需要显示调试信息，因为它只在控制台输出
                showDebug('Page loaded, initializing video background...');

                // 初始化视频背景
                initVideoBackground();

                // 添加视频事件监听器
                const videoBg = document.getElementById('video-bg');
                videoBg.addEventListener('playing', () => {
                    console.log('Video is playing');
                    showDebug('Video is now playing');
                });
                videoBg.addEventListener('error', (e) => {
                    console.error(`Video error: ${e}`);
                    showDebug(`Video error: ${e}`);
                });

                // 不需要隐藏调试信息，因为它只在控制台输出
            } catch (error) {
                console.error(`Error in video setup: ${error.message}`);
                showDebug(`Error in video setup: ${error.message}`);
            }
        });

        // DOM Elements
        const chatInput = document.getElementById('chat-input');
        const sendButton = document.getElementById('send-button');
        const chatMessages = document.getElementById('chat-messages');
        const mediaUpload = document.getElementById('media-upload');
        const fileInput = document.getElementById('file-input');
        const mediaPreview = document.getElementById('media-preview');
        const gradientBg = document.querySelector('.gradient-bg');

        // Store uploaded files
        let uploadedFiles = [];

        // Dynamic background colors
        const colors = [
            { pink: '#FF6B6B', pinkRgb: '255, 107, 107', blue: '#00C4CC', blueRgb: '0, 196, 204' }, // Default - Sunburn Pink & Chlorine Blue
            { pink: '#FF9E7D', pinkRgb: '255, 158, 125', blue: '#7D67FF', blueRgb: '125, 103, 255' }, // Sunset & Twilight
            { pink: '#FF5E87', pinkRgb: '255, 94, 135', blue: '#00D9B8', blueRgb: '0, 217, 184' }, // Neon Pink & Mint
            { pink: '#FF7EB3', pinkRgb: '255, 126, 179', blue: '#7B68EE', blueRgb: '123, 104, 238' }, // Bubblegum & Lavender
            { pink: '#FF8C42', pinkRgb: '255, 140, 66', blue: '#0096C7', blueRgb: '0, 150, 199' }  // Tangerine & Ocean
        ];

        let colorIndex = 0;

        // Change background colors periodically
        function changeBackgroundColor() {
            colorIndex = (colorIndex + 1) % colors.length;
            const newColors = colors[colorIndex];

            document.documentElement.style.setProperty('--pink', newColors.pink);
            document.documentElement.style.setProperty('--pink-rgb', newColors.pinkRgb);
            document.documentElement.style.setProperty('--blue', newColors.blue);
            document.documentElement.style.setProperty('--blue-rgb', newColors.blueRgb);
        }

        // Set interval for color change (every 30 seconds)
        setInterval(changeBackgroundColor, 30000);

        // Add ripple effect on click
        document.addEventListener('click', function(e) {
            const ripple = document.createElement('div');
            ripple.classList.add('ripple');
            ripple.style.left = e.clientX + 'px';
            ripple.style.top = e.clientY + 'px';
            document.body.appendChild(ripple);

            setTimeout(() => {
                ripple.remove();
            }, 1000);
        });

        // Media upload handling
        mediaUpload.addEventListener('click', () => {
            fileInput.click();
        });

        fileInput.addEventListener('change', (e) => {
            const files = Array.from(e.target.files);
            if (files.length === 0) return;

            // Add files to the uploadedFiles array
            uploadedFiles = [...uploadedFiles, ...files];

            // Show media preview
            updateMediaPreview();
        });

        // Update media preview
        function updateMediaPreview() {
            // Clear current preview
            mediaPreview.innerHTML = '';

            if (uploadedFiles.length === 0) {
                mediaPreview.style.display = 'none';
                return;
            }

            // Show preview container
            mediaPreview.style.display = 'flex';

            // Add preview for each file
            uploadedFiles.forEach((file, index) => {
                const previewItem = document.createElement('div');
                previewItem.className = 'preview-item';

                if (file.type.startsWith('image/')) {
                    // Image preview
                    const img = document.createElement('img');
                    img.src = URL.createObjectURL(file);
                    previewItem.appendChild(img);
                } else if (file.type.startsWith('audio/')) {
                    // Audio preview
                    const audioPreview = document.createElement('div');
                    audioPreview.className = 'audio-preview';
                    audioPreview.innerHTML = '<i class="fas fa-music"></i>';
                    previewItem.appendChild(audioPreview);
                } else if (file.type.startsWith('video/')) {
                    // Video preview
                    const video = document.createElement('video');
                    video.src = URL.createObjectURL(file);
                    video.muted = true;
                    previewItem.appendChild(video);
                }

                // Add remove button
                const removeBtn = document.createElement('div');
                removeBtn.className = 'remove-media';
                removeBtn.innerHTML = '<i class="fas fa-times"></i>';
                removeBtn.addEventListener('click', () => {
                    uploadedFiles.splice(index, 1);
                    updateMediaPreview();
                });

                previewItem.appendChild(removeBtn);
                mediaPreview.appendChild(previewItem);
            });
        }

        // Add a typing indicator
        function addTypingIndicator() {
            // Show chat messages container if it's hidden
            if (chatMessages.style.display === 'none' || !chatMessages.style.display) {
                chatMessages.style.display = 'block';
            }

            const indicatorDiv = document.createElement('div');
            indicatorDiv.id = 'typing-indicator';
            indicatorDiv.className = 'message ai-message';
            indicatorDiv.innerHTML = `
                <div class="typing-indicator">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            `;
            chatMessages.appendChild(indicatorDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // Remove typing indicator
        function removeTypingIndicator() {
            const indicator = document.getElementById('typing-indicator');
            if (indicator) {
                indicator.remove();
            }
        }

        // Add a message to the chat
        function addMessage(message, isUser = false, mediaFiles = []) {
            // Show chat messages container if it's hidden
            if (chatMessages.style.display === 'none' || !chatMessages.style.display) {
                chatMessages.style.display = 'block';
            }

            const messageDiv = document.createElement('div');
            messageDiv.className = isUser ? 'message user-message' : 'message ai-message';

            // Handle HTML content for formatted responses
            if (message.includes('<') && message.includes('>')) {
                messageDiv.innerHTML = message;
            } else {
                messageDiv.textContent = message;
            }

            // Add media files if any
            if (mediaFiles.length > 0) {
                const mediaContainer = document.createElement('div');
                mediaContainer.className = 'message-media';

                mediaFiles.forEach(file => {
                    if (file.type.startsWith('image/')) {
                        // Image file
                        const img = document.createElement('img');
                        img.src = URL.createObjectURL(file);
                        img.style.maxWidth = '100%';
                        img.style.borderRadius = '8px';
                        img.style.marginTop = '0.5rem';
                        mediaContainer.appendChild(img);
                    } else if (file.type.startsWith('audio/')) {
                        // Audio file
                        const audio = document.createElement('audio');
                        audio.src = URL.createObjectURL(file);
                        audio.controls = true;
                        audio.style.width = '100%';
                        audio.style.marginTop = '0.5rem';
                        mediaContainer.appendChild(audio);
                    } else if (file.type.startsWith('video/')) {
                        // Video file
                        const video = document.createElement('video');
                        video.src = URL.createObjectURL(file);
                        video.controls = true;
                        video.style.maxWidth = '100%';
                        video.style.borderRadius = '8px';
                        video.style.marginTop = '0.5rem';
                        mediaContainer.appendChild(video);
                    }
                });

                messageDiv.appendChild(mediaContainer);
            }

            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;

            // Apply dissolve effect
            messageDiv.classList.add('dissolve-in');
        }

        // 格式化AI响应
        function formatPerfumeResponse(text) {
            // 转换换行符为段落
            const paragraphs = text.split('\n\n').filter(p => p.trim() !== '');
            return paragraphs.map(p => `<p>${p.replace(/\n/g, '<br>')}</p>`).join('');
        }

        // Send a message to the DeepSeek API
        async function sendToDeepSeekAPI(userMessage, mediaFiles = []) {
            try {
                addTypingIndicator();

                // Prepare the message for API
                let apiMessage = userMessage;

                // Add descriptions of media files
                if (mediaFiles.length > 0) {
                    apiMessage += '\n\n[附带的媒体文件: ' +
                        mediaFiles.map(file => {
                            const type = file.type.split('/')[0];
                            return `${type === 'image' ? '图片' : type === 'audio' ? '音频' : '视频'} (${file.name})`;
                        }).join(', ') + ']';
                }

                console.log('Sending message to DeepSeek API:', apiMessage);

                const response = await fetch('https://api.deepseek.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${window.CONFIG ? window.CONFIG.DEEPSEEK_API_KEY : window.YesterdayOnceMoreAPI ? window.YesterdayOnceMoreAPI.DEEPSEEK_API_KEY : 'YOUR_API_KEY_HERE'}`
                    },
                    body: JSON.stringify({
                        model: window.CONFIG ? window.CONFIG.DEEPSEEK_MODEL : window.YesterdayOnceMoreAPI ? window.YesterdayOnceMoreAPI.DEEPSEEK_MODEL : 'deepseek-V3',
                        messages: [
                            {
                                role: 'system',
                                content: '你是昨日重现（Yesterday Once More）的AI助手，一个智能对话助手。你擅长分析用户的描述、图片、音频和视频，并提供有用的信息和帮助。你的回答应该富有创意，同时保持专业性。你的风格应该既有诗意又有科学性，能够唤起人们对过去美好时光的怀念。'
                            },
                            {
                                role: 'user',
                                content: apiMessage
                            }
                        ],
                        temperature: 0.7,
                        max_tokens: 800
                    })
                });

                removeTypingIndicator();

                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('API error:', errorText);
                    addMessage('抱歉，我在连接到 DeepSeek API 时遇到了问题。请检查你的 API 密钥并稍后再试。', false);
                    return;
                }

                const data = await response.json();
                console.log('API response:', data);

                if (!data.choices || !data.choices[0] || !data.choices[0].message) {
                    console.error('Unexpected API response format:', data);
                    addMessage('抱歉，我收到了意外的响应格式。请再试一次。', false);
                    return;
                }

                const aiResponse = data.choices[0].message.content;

                // Format the response to highlight perfume notes
                const formattedResponse = formatPerfumeResponse(aiResponse);

                addMessage(formattedResponse, false);
            } catch (error) {
                removeTypingIndicator();
                console.error('Error sending message:', error);

                // Fallback response
                // 使用欢迎信息作为回退响应
                const fallbackResponse = translations[currentLang].welcome;

                addMessage(fallbackResponse, false);
            }
        }

        // Send message
        function sendMessage() {
            const message = chatInput.value.trim();

            if (!message && uploadedFiles.length === 0) {
                return;
            }

            // Add user message to chat
            addMessage(message, true, uploadedFiles);

            // Clear input
            chatInput.value = '';

            // Keep a copy of uploaded files for display
            const sentFiles = [...uploadedFiles];

            // Clear uploaded files
            uploadedFiles = [];
            updateMediaPreview();

            // Send to API
            sendToDeepSeekAPI(message, sentFiles);
        }

        // Event listeners
        sendButton.addEventListener('click', sendMessage);

        chatInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        // Language switching
        const enLangBtn = document.getElementById('en-lang');
        const zhLangBtn = document.getElementById('zh-lang');

        // Default language is English
        let currentLang = 'en';

        // Text content for different languages
        const translations = {
            en: {
                welcome: "Welcome to Yesterday Once More! I'm your AI Scent Alchemist. Share a memory with me—a few words, a photo, a video, or even a song—and I'll transform the feeling of it into a unique perfume recipe.",
                inputPlaceholder: "Type your message here...",
                sendButton: "Send",
                siteTitle: "Yesterday Once More"
            },
            zh: {
                welcome: "欢迎来到昨日重现！我是你的AI香氛炼金师。与我分享一段记忆——几句话、一张照片、一段视频，甚至一首歌——我将把这种感觉转化为独特的香水配方。",
                inputPlaceholder: "在这里输入你的消息...",
                sendButton: "发送",
                siteTitle: "昨日重现"
            }
        };

        // Update UI language
        function updateLanguage(lang) {
            currentLang = lang;

            // Update active button
            if (lang === 'en') {
                enLangBtn.classList.add('active');
                zhLangBtn.classList.remove('active');

                // Show English content, hide Chinese content
                document.querySelectorAll('.en-content').forEach(el => el.style.display = 'block');
                document.querySelectorAll('.zh-content').forEach(el => el.style.display = 'none');
            } else {
                zhLangBtn.classList.add('active');
                enLangBtn.classList.remove('active');

                // Show Chinese content, hide English content
                document.querySelectorAll('.en-content').forEach(el => el.style.display = 'none');
                document.querySelectorAll('.zh-content').forEach(el => el.style.display = 'block');
            }

            // Make sure the quote text is visible
            document.querySelectorAll('.quote-text').forEach(el => {
                if (el.classList.contains(lang + '-content')) {
                    el.style.display = 'block';
                } else {
                    el.style.display = 'none';
                }
            });

            // Update placeholder and button text
            document.getElementById('chat-input').placeholder = translations[lang].inputPlaceholder;
            document.getElementById('send-button').textContent = translations[lang].sendButton;

            // Update site title
            document.querySelector('.logo').textContent = translations[lang].siteTitle;

            // 移除香水页面相关代码

            // Update welcome message if it's the only message in the chat
            const chatMessages = document.getElementById('chat-messages');
            if (chatMessages.children.length === 1 && chatMessages.children[0].classList.contains('ai-message')) {
                chatMessages.innerHTML = '';
                addMessage(translations[lang].welcome, false);
            }
        }

        // Language button event listeners
        enLangBtn.addEventListener('click', () => updateLanguage('en'));
        zhLangBtn.addEventListener('click', () => updateLanguage('zh'));

        // 移除页面导航相关代码

        // Initialize language to English
        updateLanguage('en');

        // Add initial message after a delay
        setTimeout(() => {
            addMessage(translations[currentLang].welcome, false);
        }, 2000);
    </script>

    <div class="footer">
        <div class="footer-left">
            © 2023 Yesterday Once More
        </div>
        <div class="footer-right">
            <div class="social-icons">
                <a href="#" class="social-icon"><i class="fab fa-linkedin-in"></i></a>
                <a href="#" class="social-icon"><i class="fab fa-twitter"></i></a>
                <a href="#" class="social-icon"><i class="fab fa-instagram"></i></a>
                <a href="#" class="social-icon"><i class="fab fa-tiktok"></i></a>
                <a href="#" class="social-icon"><span class="xiaohongshu">小红书</span></a>
            </div>
        </div>
    </div>
</body>
</html>
